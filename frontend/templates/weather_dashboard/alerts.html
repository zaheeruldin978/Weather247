{% extends 'base.html' %}
{% load static %}

{% block title %}Weather Alerts - Weather-247{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8" x-data="weatherAlerts" x-init="loadAlerts()" x-cloak>
    <!-- Loading Overlay -->
    <div x-show="loading" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-lg text-gray-600">Loading weather alerts...</p>
        </div>
    </div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-red-500 via-orange-500 to-amber-600 rounded-2xl shadow-xl border border-red-400/20 hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Weather Alerts</h1>
                        <p class="text-gray-600 mt-1">Stay informed about severe weather conditions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- City Selector -->
        <div class="relative bg-gradient-to-br from-white via-red-50 to-orange-50 rounded-3xl shadow-xl border border-red-100 p-8 mb-8">
            <!-- Decorative background elements -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-red-300/20 rounded-full blur-3xl"></div>
            <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-orange-300/20 rounded-full blur-3xl"></div>
            
            <div class="relative z-10">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Weather Alert Monitoring</h3>
                    <p class="text-gray-600">Select a city to check for active weather alerts and warnings</p>
                    <div x-show="selectedCity" class="mt-4 inline-flex items-center gap-2 bg-gradient-to-r from-blue-100 to-indigo-100 px-4 py-2 rounded-full border border-blue-200">
                        <span class="text-blue-600">üìç</span>
                        <span class="font-medium text-blue-800">Currently monitoring: <span x-text="selectedCity"></span></span>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-6 items-center">
                    <div class="flex-1" style="position: relative; overflow: visible;">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Search City for Alerts</label>
                        <div class="relative group" style="position: relative; overflow: visible;">
                            <input 
                                type="text" 
                                x-model="searchQuery" 
                                @input="searchCities()"
                                @focus="searchCities()"
                                @keyup.enter="searchAndSelectCity()"
                                placeholder="Type city name (e.g., London, New York, Tokyo)"
                                class="w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-red-500/20 focus:border-red-500 text-lg font-medium shadow-lg hover:shadow-xl transition-all duration-300 pr-16 bg-white/90 backdrop-blur-sm group-hover:border-gray-300"
                                spellcheck="false"
                                autocomplete="off"
                            >
                            <div class="absolute inset-y-0 right-0 pr-6 flex items-center">
                                <button x-show="searchQuery" @click="searchQuery = ''; searchCities()" class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-all duration-200">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <svg x-show="!searchQuery" class="h-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            
                            <!-- Search Results Dropdown -->
                            <div x-show="searchQuery && filteredCities.length > 0" 
                                 class="absolute z-[9999] w-full mt-2 bg-white border border-gray-200 rounded-2xl shadow-2xl max-h-60 overflow-y-auto"
                                 style="position: absolute; top: 100%; left: 0; right: 0; z-index: 9999; min-height: 100px;">
                                <div class="p-2">
                                    <div class="text-xs font-medium text-gray-500 px-3 py-2 border-b border-gray-100">
                                        <span x-text="filteredCities.length + ' cities found'"></span>
                                    </div>
                                    <template x-for="city in filteredCities" :key="city">
                                        <div @click="selectCity(city)" 
                                             class="px-4 py-3 hover:bg-gradient-to-r hover:from-red-50 hover:to-orange-50 cursor-pointer rounded-xl mx-1 transition-all duration-200 group">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-8 h-8 bg-gradient-to-br from-red-100 to-orange-100 rounded-full flex items-center justify-center group-hover:from-red-200 group-hover:to-orange-200 transition-all duration-200">
                                                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="font-medium text-gray-900 group-hover:text-red-700 transition-colors duration-200" x-text="city"></div>
                                                </div>
                                                <div class="text-xs text-gray-400 group-hover:text-red-500 transition-colors duration-200">
                                                    Click to select
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search Status Indicator -->
                        <div class="mt-2 text-sm text-gray-500">
                            <span x-show="searchQuery">üîç Searching for: <span class="font-medium" x-text="searchQuery"></span></span>
                            <span x-show="!searchQuery">üí° Type to search cities</span>
                            <span x-show="filteredCities.length > 0 && searchQuery">‚úÖ Found <span class="font-medium" x-text="filteredCities.length"></span> cities</span>
                        </div>
                        

                        

                        

                    </div>
                    
                    <button @click="loadAlerts()" :disabled="loading" class="bg-gradient-to-r from-red-500 via-orange-500 to-amber-600 hover:from-red-600 hover:via-orange-600 hover:to-amber-700 disabled:opacity-50 text-white px-8 py-4 rounded-2xl font-bold transition-all duration-300 transform hover:scale-105 disabled:transform-none shadow-lg hover:shadow-xl border border-red-400/20 text-lg">
                        <span x-show="!loading" class="flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            Check Alerts
                        </span>
                    <span x-show="loading" class="flex items-center gap-2">
                            <svg class="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Loading...
                    </span>
                    </button>
                </div>
                </div>
            </div>

        <!-- Alerts Display -->
        <div x-show="alertsData" class="space-y-6">
            <!-- No Alerts Message -->
            <div x-show="!alertsData.alerts || alertsData.alerts.length === 0" class="relative bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 border border-green-200 rounded-3xl p-8 text-center shadow-lg overflow-hidden">
                <!-- Decorative background elements -->
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-green-300/20 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-emerald-300/20 rounded-full blur-3xl"></div>
                
                <div class="relative z-10">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-green-800 mb-3">No Active Weather Alerts</h3>
                    <p class="text-green-700 text-lg">There are currently no active weather alerts for <span class="font-semibold" x-text="alertsData.city"></span>.</p>
                    <div class="mt-6 p-4 bg-white/60 rounded-2xl border border-green-200/50">
                        <p class="text-green-600 text-sm">This means weather conditions are currently normal and safe. No severe weather warnings or advisories are in effect for this area.</p>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 rounded-xl border border-blue-200">
                        <p class="text-blue-700 text-sm">üí° <strong>Note:</strong> Weather alerts are fetched in real-time from OpenWeather API. If you believe there should be alerts, please check with local weather authorities.</p>
                    </div>
                </div>
    </div>

    <!-- Active Alerts -->
            <div x-show="alertsData.alerts && alertsData.alerts.length > 0" class="space-y-4">
                <div class="flex items-center justify-between">
                <h3 class="text-xl font-semibold text-gray-900">Active Weather Alerts</h3>
                    <div class="text-sm text-gray-600 bg-blue-100 px-3 py-1 rounded-full">
                        üìç <span x-text="alertsData.city"></span>
                    </div>
                </div>
                <template x-for="(alert, idx) in alertsData.alerts" :key="(alert.event_name || alert.event || 'alert') + '-' + idx">
                    <div class="bg-red-50 border-l-4 border-red-400 rounded-xl p-6">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <div class="ml-3 flex-1">
                                <h4 class="text-lg font-semibold text-red-800" x-text="alert.event_name || alert.event || 'Weather Alert'"></h4>
                                <p class="text-red-700 mt-1" x-text="alert.description || alert.tag || 'No description available'"></p>
                                <div class="mt-3 flex flex-wrap gap-2">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span x-text="alert.start ? new Date(alert.start * 1000).toLocaleString() : 'Start time unavailable'"></span>
                                    </span>
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span x-text="alert.end ? new Date(alert.end * 1000).toLocaleString() : 'End time unavailable'"></span>
                                    </span>
                            </div>
                        </div>
                    </div>
                    </div>
                </template>
        </div>
    </div>

        <!-- Safety Guidelines -->
        <div class="relative bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl p-8 mt-8 border border-blue-100 shadow-xl overflow-hidden">
            <!-- Decorative background elements -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-300/20 rounded-full blur-3xl"></div>
            <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-indigo-300/20 rounded-full blur-3xl"></div>
            <div class="absolute top-1/2 left-1/3 w-24 h-24 bg-purple-300/20 rounded-full blur-2xl"></div>
            
            <div class="relative z-10 text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-3xl font-bold bg-gradient-to-r from-blue-700 via-indigo-700 to-purple-700 bg-clip-text text-transparent mb-2">Weather Safety Guidelines</h3>
                <p class="text-gray-600 text-lg">Essential safety tips for different weather conditions</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="group bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-blue-200/50 hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mb-4 shadow-md group-hover:shadow-lg transition-all duration-300">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                </div>
                    <h4 class="text-xl font-bold text-gray-900 mb-3">Thunderstorms</h4>
                    <ul class="text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2 mt-1">‚ö°</span>
                            <span>Stay indoors during storms</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2 mt-1">üè†</span>
                            <span>Avoid open areas and water</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2 mt-1">üîå</span>
                            <span>Unplug electrical devices</span>
                        </li>
                    </ul>
            </div>

                <div class="group bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-orange-200/50 hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center mb-4 shadow-md group-hover:shadow-lg transition-all duration-300">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
        </div>
                    <h4 class="text-xl font-bold text-gray-900 mb-3">Heat Waves</h4>
                    <ul class="text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">üíß</span>
                            <span>Stay hydrated</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">üè†</span>
                            <span>Avoid outdoor activities</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">‚ùÑÔ∏è</span>
                            <span>Use air conditioning</span>
                        </li>
                    </ul>
    </div>

                <div class="group bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-purple-200/50 hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mb-4 shadow-md group-hover:shadow-lg transition-all duration-300">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path>
                        </svg>
                    </div>
                    <h4 class="text-xl font-bold text-gray-900 mb-3">Heavy Rain</h4>
                    <ul class="text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-purple-600 mr-2 mt-1">üåä</span>
                            <span>Avoid flooded areas</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-purple-600 mr-2 mt-1">üöó</span>
                            <span>Drive carefully</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-purple-600 mr-2 mt-1">üîç</span>
                            <span>Check drainage systems</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Alpine.js data and methods
document.addEventListener('alpine:init', () => {
    Alpine.data('weatherAlerts', () => ({
        selectedCity: 'London',
        searchQuery: '',
        filteredCities: [],
        alertsData: null,
        loading: false,
        cities: ['London', 'New York', 'Tokyo', 'Sydney', 'Dubai', 'Mumbai', 'Paris', 'Berlin', 'Moscow', 'Beijing', 'Delhi', 'Mexico City', 'S√£o Paulo', 'Cairo', 'Lagos', 'Johannesburg', 'Nairobi', 'Casablanca', 'Algiers', 'Tunis', 'Tripoli', 'Khartoum', 'Addis Ababa', 'Dar es Salaam', 'Kinshasa', 'Luanda', 'Lusaka', 'Harare', 'Gaborone', 'Windhoek', 'Maputo', 'Antananarivo', 'Port Louis', 'Victoria', 'Moroni', 'Saint-Denis', 'Saint-Denis', 'Port-aux-Fran√ßais', 'McMurdo Station', 'Vostok Station', 'Amundsen-Scott Station', 'Palmer Station', 'Rothera Station', 'Mawson Station', 'Davis Station', 'Casey Station', 'Dumont d\'Urville Station', 'Concordia Station', 'Halley Station', 'Neumayer Station', 'Troll Station', 'Svea Station', 'Wasa Station', 'Aboa Station', 'Maitri Station', 'Bharati Station', 'Dakshin Gangotri Station', 'Himadri Station', 'Indira Station', 'Maitri Station', 'Bharati Station', 'Dakshin Gangotri Station', 'Himadri Station', 'Indira Station', 'Karachi', 'Lahore', 'Islamabad', 'Gujranwala', 'Faisalabad', 'Rawalpindi', 'Multan', 'Peshawar', 'Quetta', 'Sialkot', 'Bahawalpur', 'Sargodha', 'Sukkur', 'Jhang', 'Sheikhupura', 'Rahim Yar Khan', 'Gujrat', 'Mardan', 'Kasur', 'Dera Ghazi Khan', 'Sahiwal', 'Nawabshah', 'Mirpur Khas', 'Okara', 'Bangalore', 'Hyderabad', 'Chennai', 'Kolkata', 'Ahmedabad', 'Pune', 'Jaipur', 'Surat', 'Lucknow', 'Kanpur', 'Nagpur', 'Indore', 'Thane', 'Bhopal', 'Patna', 'Vadodara', 'Ghaziabad', 'Ludhiana', 'Agra', 'Nashik', 'Faridabad', 'Meerut', 'Rajkot', 'Kalyan', 'Vasai', 'Varanasi', 'Srinagar', 'Aurangabad', 'Navi Mumbai', 'Solapur', 'Miami', 'Houston', 'Los Angeles', 'Chicago', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose', 'Austin', 'Jacksonville', 'Fort Worth', 'Columbus', 'Charlotte', 'San Francisco', 'Indianapolis', 'Seattle', 'Denver', 'Washington', 'Boston', 'El Paso', 'Nashville', 'Detroit', 'Oklahoma City', 'Portland', 'Las Vegas', 'Louisville', 'Memphis', 'Baltimore', 'Milwaukee', 'Albuquerque', 'Tucson', 'Fresno', 'Sacramento', 'Kansas City', 'Long Beach', 'Mesa', 'Virginia Beach', 'Atlanta', 'Colorado Springs', 'Raleigh', 'Omaha', 'Miami Beach', 'Tampa', 'Orlando', 'New Orleans', 'Baton Rouge', 'Mobile', 'Birmingham', 'Montgomery', 'Jackson', 'Little Rock', 'Shreveport', 'Biloxi', 'Gulfport', 'Pensacola', 'Tallahassee', 'Jacksonville Beach', 'Daytona Beach', 'Cocoa Beach', 'Melbourne', 'West Palm Beach', 'Fort Lauderdale', 'Hollywood', 'Coral Gables', 'Hialeah', 'Miami Gardens', 'Miramar', 'Pembroke Pines', 'Plantation', 'Sunrise', 'Tamarac', 'Coral Springs', 'Margate', 'North Lauderdale', 'Lauderhill', 'Oakland Park', 'Fort Lauderdale Beach', 'Deerfield Beach', 'Boca Raton', 'Delray Beach', 'Boynton Beach', 'Lake Worth', 'Greenacres', 'Wellington', 'Royal Palm Beach', 'Jupiter', 'Palm Beach Gardens', 'North Palm Beach', 'Palm Beach', 'West Palm Beach', 'Lake Park', 'Riviera Beach', 'Palm Springs', 'Lake Clarke Shores', 'Havertown', 'Philadelphia', 'Pittsburgh', 'Cleveland', 'Cincinnati', 'Toledo', 'Akron', 'Dayton', 'Youngstown', 'Canton', 'Lorain', 'Hamilton', 'Springfield', 'Kettering', 'Elyria', 'Lakewood', 'Cuyahoga Falls', 'Middletown', 'Newark', 'Mansfield', 'Mentor', 'Beavercreek', 'Lancaster', 'Brunswick', 'Hilliard', 'Upper Arlington', 'Pickerington', 'Gahanna', 'Dublin', 'Westerville', 'Reynoldsburg', 'Grove City', 'Huber Heights', 'Kettering', 'Centerville', 'Beavercreek', 'Springboro', 'Mason', 'Liberty Township', 'West Chester', 'Hamilton', 'Fairfield', 'Forest Park', 'Sharonville', 'Glendale', 'Reading', 'Norwood', 'Elmwood Place', 'St. Bernard', 'Cheviot', 'Addyston', 'Cleves', 'North Bend', 'Mariemont', 'Newtown', 'Terrace Park', 'Amberley Village', 'Silverton', 'Lincoln Heights', 'Woodlawn', 'Glendale', 'Reading', 'Norwood', 'Elmwood Place', 'St. Bernard', 'Cheviot', 'Addyston', 'Cleves', 'North Bend', 'Mariemont', 'Newtown', 'Terrace Park', 'Amberley Village', 'Silverton', 'Lincoln Heights', 'Woodlawn'],
        
        // Delegate to global icon helper (with night support)
        getWeatherIcon(condition, isNight = false) {
            return window.getWeatherIcon(condition, !!isNight);
        },
        
        init() {
            this.filteredCities = [];
        },
        
        searchCities() {
            if (!this.searchQuery.trim()) {
                this.filteredCities = [];
                return;
            }
            
            const query = this.searchQuery.toLowerCase();
            this.filteredCities = this.cities.filter(city => 
                city.toLowerCase().includes(query)
            );
        },
        
        searchAndSelectCity() {
            const query = this.searchQuery.trim();
            if (!query) return;
            
            // Try to find exact match first
            let exactMatch = this.cities.find(city => 
                city.toLowerCase() === query.toLowerCase()
            );
            
            // If no exact match, try partial match
            if (!exactMatch) {
                exactMatch = this.cities.find(city => 
                    city.toLowerCase().includes(query.toLowerCase())
                );
            }
            
            if (exactMatch) {
                this.selectCity(exactMatch);
            }
        },
        
        selectCity(city) {
            this.selectedCity = city;
            this.searchQuery = city;
            this.filteredCities = [];
            this.loadAlerts();
        },
        
        async loadAlerts() {
            this.loading = true;
            console.log(`üîç Loading alerts for city: ${this.selectedCity}`);
            
            try {
                const response = await fetch(`/api/weather-alerts/?city=${encodeURIComponent(this.selectedCity)}`);
                console.log(`üì° Response for ${this.selectedCity}:`, response);
                
                const data = await response.json();
                console.log(`üìä Alerts data received for ${this.selectedCity}:`, data);
                
                if (data && !data.error) {
                    // Use the real data from the API
                    this.alertsData = Array.isArray(data)
                        ? { city: this.selectedCity, alerts: data }
                        : data;
                    console.log(`‚úÖ Alerts loaded for ${this.selectedCity}:`, this.alertsData);
                } else {
                    this.alertsData = { city: this.selectedCity, alerts: [] };
                    console.log(`‚ö†Ô∏è No alerts data for ${this.selectedCity}, using empty array`);
                }
                
            } catch (e) {
                console.error(`‚ùå Error fetching alerts for ${this.selectedCity}:`, e);
                this.alertsData = { city: this.selectedCity, alerts: [] };
            } finally {
                this.loading = false;
                console.log(`üèÅ Finished loading alerts for ${this.selectedCity}`);
            }
        }
    }));
});
    
// Alerts are now initialized using Alpine.js x-init directive
</script>
{% endblock %}
